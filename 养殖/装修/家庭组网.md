---
title: 家庭组网
description: Network Mesh
published: true
date: 2025-09-15T08:20:26.639Z
tags: 
editor: markdown
dateCreated: 2025-09-15T01:26:10.205Z
---

# 功能需求
1. 2000M带宽的宽带，2.5G局域网，每个房间都有网口
2. 通过软路由实现管理功能
3. 家庭智能设备组网（支持Wi-Fi，BLE协议，Zigbee协议），实现全屋智能
4. 支持家庭设备（包括电视）直接连接NAS进行媒体文件读取

# 拓扑图
![家庭组网拓扑.png](/家庭组网拓扑.png)

# 设备型号
- 网线：COMMSCOPE（康普）六类网线（0.51mm）
- 交换机：Tenda（腾达）16口千兆交换机（未来有预算再换2.5G电口的）
- 路由器（AP）：小米路由器BE6500 Pro
- 软路由：友善R5C 2GB内存32GB micro SD卡
- NAS：绿联私有云DH4300 Plus 8G四盘位
- 硬盘：SEAGATE（希捷）16TB台式机硬盘
- HA终端：HomeAssistant Green盒子
- Zigbee网关：Aqara绿米联创M1S网关

# 路由器
考虑到需求，需要通过软路由进行管理，这里可以选择主路由或者旁路由形式。双方各有利弊：
|路由模式|优势|劣势|
|:----|:----|:----|
|主路由模式|设置简单，效能高|如果软路由出现问题，会导致全局断网|
|旁路由模式|设备更新调配等不会造成全家断网，可以进行网段管理|性能有损耗|
考虑到自己的使用情况，也不需要进行网段管理，所以用了比较简单的主路由模式。软路由的设备选择的是友善R5C，一个2.5G的WAN口和一个2.5G的LAN口，不得不说Nano Pi就是为了软路由而生的：
![r5cc-01.jpg](/r5cc-01.jpg)
而对应的固件选用的是国人根据OpenWrt开发的分支ImmortalWrt，安装流程如下：
## 制作软路由（R5C + ImmortalWrt）
### 1、烧录SD卡
准备一张Micro SD卡和一个读卡器，ImmortalWrt加上需要的插件整体大小也不超过1GB，因此买一个足够便宜的SD卡即可。

第一步是去[ImmortalWrt的官网](https://firmware-selector.immortalwrt.org/)下载组件，要选择相应的设备名称和版本，我的设备是FriendlyARM NanoPi R5C，版本选择的是24.10.2。版本不宜选择Snapshot，路由器还是以稳定为主。点击SYSUPGRADE (EXT4)下载对应的镜像文件（无需解压）

第二步就是把镜像烧录到SD卡上，我选择的软件是balenaEtcher，下载后可以直接打开使用，无需安装。将刚刚下载的镜像烧录到SD卡上，即可弹出读卡器，把SD卡插入R5C。

### 2、初始化ImmortalWrt
将R5C的LAN口与计算机相连，插电启动R5C，随后会在计算机的以太网属性中看到连接成功，此时访问192.168.1.1可以进入路由器的管理页面。

> 如果192.168.1.1无法访问，可以去以太网的属性页面查看详细信息，找到IPv4网关，就是R5C的局域网地址。
{.is-info}

第一次进入ImmortalWrt的管理页面，用户名root，密码留空，直接登录即可，进去后可根据提示设置登陆密码。

### 3、关闭ImmortalWrt的IPv6下发功能
该步骤旨在避免IPv6地址分配导致部分功能（如代理）出现问题。

### 4、将R5C联网
将R5C的WAN口与光猫连接，此时可以在管理页面看到DHCP服务下发的IP地址。这里有两个选择，一是光猫作为光电转换的设备，由R5C进行拨号，进而可以用光模块后续代替光猫的功能（即光猫棒）；二是由光猫进行拨号，R5C作为子路由。后者由于光猫同样作为路由器进行NAT转发，光猫设备的性能一定程度上会影响网速的上限，而两个子路由导致的两次NAT转发，同样有一定的性能损耗。

前者方案的主要障碍是需要将光猫设置为桥接模式，大部分运营商默认不支持这种设置，需要要到超级管理员密码或找宽带师傅上门。这里我考虑到我办理的2000M宽带中国移动送的光猫应该性能不会太差，因此先采用子路由的方式进行联网，未来如果光猫性能出现瓶颈再说。

将R5C联网后，需要注意DHCP下发的IP地址与LAN口的分配地址是否为同一网段，注意这里不能是同一网段，因此如果光猫的网段是192.168.1.*，我们需要将brLAN分配的网段切换至其他网段，例如192.168.2.1来避免冲突。

设置完成后，使用新地址进入ImmortalWrt的管理页面，此时R5C已经可以作为一个子路由为LAN口提供通信。

### 5、安装插件

ImmortalWrt的插件页面集成了非常多的实用插件并且可以一键安装依赖，其中比较好用的插件由：